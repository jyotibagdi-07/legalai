<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Legal Risk Analyzer</title>
  <link rel="stylesheet" href="risk-analyzer.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">‚öñÔ∏è Legal Document Risk Analyzer</div>
    <nav class="menu">
      <!-- üëá change href to your real front page -->
      <a href="index.html">Dashboard</a>
      <a href="fullsum.html">Reports</a>
      <!-- üëá link to sign-in page -->
      <a href="signin.html">Account</a>
    </nav>
  </header>

  <main class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>Identify & Mitigate<br>Your Legal Risks</h2>
      <p class="muted">A comprehensive overview</p>

      <!-- Upload Box -->
      <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <p>üìÇ Drag & Drop or Click to Upload</p>
        <input id="fileInput" type="file" accept=".pdf,.doc,.docx" />
      </div>

      <div class="uploaded">
        <h3>Uploaded Documents</h3>
        <div id="docList"></div>
      </div>
    </aside>

    <!-- Analysis Section -->
    <section class="analysis">
      <div class="risk-score">
        <h3>Risk Analysis Results</h3>
        <canvas id="riskGauge"></canvas>
        <div class="score-text">
          RISK SCORE: <strong id="riskScore">0%</strong>
          <span id="riskAlert" class="alert">No Risks Yet</span>
        </div>
      </div>

      <!-- Key Risks -->
      <div class="card">
        <h3>Flagged Risks</h3>
        <ol id="riskList">
          <li>No risks detected yet. Upload a document.</li>
        </ol>
      </div>

      <!-- Risk Distribution -->
      <div class="card">
        <h3>Risk Distribution by Category</h3>
        <canvas id="riskChart"></canvas>
      </div>

      <div class="actions">
        <!-- üëá summary page link -->
        <button class="btn primary" onclick="window.location.href='summary.html'">Generate Full Report (PDF)</button>
        <button class="btn">Schedule Consultation</button>
      </div>
    </section>
  </main>

  <script>
    const fileInput = document.getElementById("fileInput");
    const docList = document.getElementById("docList");
    const riskScoreEl = document.getElementById("riskScore");
    const riskAlertEl = document.getElementById("riskAlert");
    const riskList = document.getElementById("riskList");

    let gaugeChart, barChart;

    // === File Upload ===
    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (!file) return;

      // Show file in list
      docList.innerHTML = `
        <div class="doc-item">
          <span>${file.name}</span>
          <button onclick="analyzeDoc('${file.name}')">Review Risks</button>
        </div>
      `;
    });

    // === Fake Analysis (replace with backend API later) ===
    function analyzeDoc(name) {
      // Example results from your PDF analysis
      const risks = [
        "Blank values: Security deposit, commission %, exclusivity radius missing.",
        "Manufacturer discretion: May refuse to supply goods.",
        "Post-termination commission clause unfavorable.",
        "Exclusivity radius ambiguous.",
        "Duplicated clauses weaken enforceability."
      ];

      const score = 72; // from analysis

      // Update score
      riskScoreEl.textContent = score + "%";
      riskAlertEl.textContent = score >= 70 ? "HIGH RISK DETECTED" : "LOW RISK";
      riskAlertEl.style.color = score >= 70 ? "#dc2626" : "#059669";

      // Update risk list
      riskList.innerHTML = "";
      risks.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r;
        riskList.appendChild(li);
      });

      // Update charts
      updateCharts(score);
    }

    // === Charts ===
    function updateCharts(score) {
      const ctxGauge = document.getElementById('riskGauge').getContext('2d');
      if (gaugeChart) gaugeChart.destroy();
      gaugeChart = new Chart(ctxGauge, {
        type: 'doughnut',
        data: {
          labels: ['Risk', 'Safe'],
          datasets: [{
            data: [score, 100 - score],
            backgroundColor: ['#dc2626', '#e5e7eb'],
            borderWidth: 0
          }]
        },
        options: {
          cutout: '70%',
          plugins: { legend: { display: false } }
        }
      });

      const ctx = document.getElementById('riskChart').getContext('2d');
      if (barChart) barChart.destroy();
      barChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Contractual', 'Compliance', 'Financial', 'Operational'],
          datasets: [
            { label: 'High Risk', data: [3, 0, 1, 1], backgroundColor: '#dc2626' },
            { label: 'Medium Risk', data: [2, 1, 0, 1], backgroundColor: '#f59e0b' },
            { label: 'Low Risk', data: [1, 1, 0, 0], backgroundColor: '#059669' }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }
  </script>
</body>
</html>
